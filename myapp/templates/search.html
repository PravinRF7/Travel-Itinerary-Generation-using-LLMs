{%load static%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Details</title>
    <link rel="stylesheet" href="{% static 'css/search.css' %}">  <!-- Update for Django static files -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<header class="top-nav">
    <a href="#home" class="logo">
        <img src="{% static 'logo.png' %}" alt="Logo">  <!-- Update for Django static files -->
    </a>
    <nav>
        <ul>
            <li><a href="{% url 'blog:index' %}" class="nav-link">Home</a></li>
            <li><a href="{% url 'blog:index' %}" class="nav-link" id="about-link">About</a></li>
            <li><a href="{% url 'blog:index' %}" class="nav-link" id="contact-link">Contact</a></li>
        </ul>
    </nav>
    <div class="nav-icons">
        <i class="icon-bell"></i>
        <div class="profile-container">
            <img src="{% static 'default-profile.jpg' %}" alt="User" class="profile-pic" id="profile-pic">
            <div class="dropdown-menu" id="dropdown-menu">
                <div class="profile-summary">
                    <img src="{% static 'default-profile.jpg' %}" alt="User" class="profile-pic-large" id="profile-summary-pic">
                    <p>Name: <strong></strong></p>
                </div>
                <hr>
                <ul>
                    <li id="show-profile"><a href="#"><i class="icon-eye"></i> Show Profile</a></li>
                    <li><a href="#" id="settings-icon"><i class="icon-settings"></i> Settings</a></li>
                    <li><a href="{% url 'logout' %}"><i class="icon-signout"></i> Sign out</a></li>
                </ul>
                <div id="profile-details" style="display: none;">
                    <div class="profile-info">
                        <button id="close-profile" class="close-btn">&times;</button>
                        <img src="{% static 'default-profile.jpg' %}" alt="User" class="profile-pic-large" id="profile-details-pic">
                        <div class="user-details">
                            <p>Name: <strong></strong></p>
                            <p>Email: <strong></strong></p>
                            <p>Phone: <strong></strong></p>
                        </div>
                    </div>
                    <label for="upload-photo" class="upload-btn">Upload Photo</label>
                    <input type="file" id="upload-photo" accept="image/*" style="display: none;">
                </div>
            </div>
        </div>
    </div>
    <button class="night-mode-toggle" onclick="toggleNightMode()">
        <span id="modeIcon">ðŸŒ™</span>
    </button>
</header>

<body>
    <div class="content-wrapper">
        <div class="container">
            <h1>Your Travel Details</h1>
            <div class="details-weather-container">
                <div class="details">
                    <p id="destination"></p>
                    <p id="dates"></p>
                    <p id="budget"></p>
                    <p id="days"></p>
                </div>
                <div id="weather-box" class="weather-container">
                    <!-- Weather data will be appended here -->          
                </div>
            </div>
            <div class="tabs" id="dayTabs">
                <!-- Tabs will be dynamically added here -->
            </div>
            <div id="tabContents">
                <!-- Tab contents will be dynamically added here -->
            </div>
            <div class="summary-section">
                <h2>Trip Summary</h2>
                <p id="trip-summary">
                    This is where you can add a brief summary of your trip. It could include highlights of the
                    destinations, must-see attractions, or important travel tips for the journey.
                </p>
            </div>
            <div class="news-section">
                <h2>Latest Travel News</h2>
                <ul class="news-articles">
                    <li><a href="#">Travel restrictions updated for 2024</a></li>
                    <li><a href="#">Best places to visit in 2024</a></li>
                    <li><a href="#">How to travel sustainably this year</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!---------------------------Footer------------------->
    <footer>
        <p>&copy; Voyage Verse-2024</p>
    </footer>

    <script>
        // Assuming Django passed these values through context
        const destination = "{{ destination }}";
        const startDate = new Date("{{ start_date }}");  // Ensure this is formatted correctly in Django
        const endDate = new Date("{{ end_date }}");  // Ensure this is formatted correctly in Django
        const budget = "{{ budget }}";
        const days = parseInt("{{ days }}");

        document.getElementById('destination').textContent = `Destination: ${destination}`;
        document.getElementById('dates').textContent = `Dates: ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}`;
        document.getElementById('budget').textContent = `Budget: ${budget}`;
        document.getElementById('days').textContent = `Number of Days: ${days}`;

        const tabsContainer = document.getElementById('dayTabs');
        const tabContents = document.getElementById('tabContents');

        for (let i = 1; i <= days; i++) {
            const tabButton = document.createElement('button');
            tabButton.textContent = `Day ${i}`;
            tabButton.classList.add('tablinks');
            if (i === 1) tabButton.classList.add('active');
            tabButton.onclick = function (event) { openTab(event, `day${i}`); };
            tabsContainer.appendChild(tabButton);

            const tabContent = document.createElement('div');
            tabContent.id = `day${i}`;
            tabContent.classList.add('tabcontent');
            if (i === 1) tabContent.classList.add('active');

            tabContent.innerHTML = `
            <div class="left-section">
                <h1>Day ${i} Itinerary</h1>
                <div id="itinerary-day${i}" class="details loading-effect">
                    <div class="animated-background">
                        <div class="loading-content">
                            <div class="loading-text-line" style="width: 90%;"></div>
                            <div class="loading-text-line" style="width: 80%;"></div>
                            <div class="loading-text-line" style="width: 85%;"></div>
                            <div class="loading-text-line" style="width: 75%;"></div>
                            <div class="loading-text-line" style="width: 88%;"></div>
                            <div class="loading-text-line" style="width: 82%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="map-section">
                <div id="map-day${i}" class="map loading-effect">
                    <div class="animated-background"></div>
                </div>
                <div class="button-container">
                    <a href="path/to/your/file.pdf" class="buttn btn-pdf">
                        <i class="fas fa-file-pdf"></i> Download as PDF
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20itinerary:%20path/to/your/file.pdf" class="buttn btn-whatsapp">
                        <i class="fab fa-whatsapp"></i> Share on WhatsApp
                    </a>
                </div>
            </div>
            `;

            tabContents.appendChild(tabContent);
        }

        function openTab(evt, dayId) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(dayId).style.display = "flex";
            evt.currentTarget.className += " active";

            const dayNum = dayId.replace('day', '');
            generateItinerary(dayNum);
        }

        const lat = 38.5; // Replace with your destination's latitude
        const lon = -78.5; // Replace with your destination's longitude
        const apiKey = 'bd5e378503939ddaee76f12ad7a627f7';
        const weatherBox = document.getElementById('weather-box');

        async function getWeather() {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
            const data = await res.json();

            const weatherDetails = `
                <h3>Weather in ${data.name}</h3>
                <p>Temperature: ${data.main.temp} Â°C</p>
                <p>Weather: ${data.weather[0].description}</p>
            `;
            weatherBox.innerHTML = weatherDetails;
        }

        getWeather();
    </script>
</body>

</html>
